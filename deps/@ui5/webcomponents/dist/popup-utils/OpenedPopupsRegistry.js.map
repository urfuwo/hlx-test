{"version":3,"file":"OpenedPopupsRegistry.js","sourceRoot":"","sources":["../../src/popup-utils/OpenedPopupsRegistry.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,QAAQ,EAAE,MAAM,sCAAsC,CAAC;AAChE,OAAkB,aAAa,CAAC;AAOhC,IAAI,cAAc,GAA4B,EAAE,CAAC;AAEjD,MAAM,cAAc,GAAG,CAAC,QAAe,EAAE,iBAA+B,EAAE,EAAE,EAAE;IAC7E,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,QAAQ,KAAK,QAAQ,CAAC,EAAE;QAC/D,cAAc,CAAC,IAAI,CAAC;YACnB,QAAQ;YACR,cAAc;SACd,CAAC,CAAC;KACH;IAED,oBAAoB,EAAE,CAAC;IAEvB,IAAI,cAAc,CAAC,MAAM,KAAK,CAAC,EAAE;QAChC,oBAAoB,EAAE,CAAC;KACvB;AACF,CAAC,CAAC;AAEF,MAAM,iBAAiB,GAAG,CAAC,QAAe,EAAE,EAAE;IAC7C,cAAc,GAAG,cAAc,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE;QAC3C,OAAO,EAAE,CAAC,QAAQ,KAAK,QAAQ,CAAC;IACjC,CAAC,CAAC,CAAC;IAEH,oBAAoB,EAAE,CAAC;IAEvB,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE;QAC3B,oBAAoB,EAAE,CAAC;KACvB;AACF,CAAC,CAAC;AAEF,MAAM,eAAe,GAAG,GAAG,EAAE;IAC5B,OAAO,CAAC,GAAG,cAAc,CAAC,CAAC;AAC5B,CAAC,CAAC;AAEF,MAAM,gBAAgB,GAAG,CAAC,KAAoB,EAAE,EAAE;IACjD,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE;QAC3B,OAAO;KACP;IAED,IAAI,QAAQ,CAAC,KAAK,CAAC,EAAE;QACpB,cAAc,CAAC,cAAc,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;KAC/D;AACF,CAAC,CAAC;AAEF,MAAM,oBAAoB,GAAG,GAAG,EAAE;IACjC,QAAQ,CAAC,gBAAgB,CAAC,SAAS,EAAE,gBAAgB,CAAC,CAAC;AACxD,CAAC,CAAC;AAEF,MAAM,oBAAoB,GAAG,GAAG,EAAE;IACjC,QAAQ,CAAC,mBAAmB,CAAC,SAAS,EAAE,gBAAgB,CAAC,CAAC;AAC3D,CAAC,CAAC;AAEF,MAAM,oBAAoB,GAAG,GAAG,EAAE;IACjC,IAAI,KAAK,CAAC;IACV,IAAI,QAAQ,GAAG,KAAK,CAAC;IAErB,KAAK,IAAI,CAAC,GAAG,cAAc,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;QACpD,KAAK,GAAG,cAAc,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC;QAEnC,IAAI,CAAC,QAAQ,IAAI,KAAK,CAAC,OAAO,EAAE;YAC/B,KAAK,CAAC,eAAe,GAAG,IAAI,CAAC;YAC7B,QAAQ,GAAG,IAAI,CAAC;SAChB;aAAM;YACN,KAAK,CAAC,eAAe,GAAG,KAAK,CAAC;SAC9B;KACD;AACF,CAAC,CAAC;AAEF,OAAO,EAAE,cAAc,EAAE,iBAAiB,EAAE,eAAe,EAAE,CAAC","sourcesContent":["import { isEscape } from \"@ui5/webcomponents-base/dist/Keys.js\";\nimport Popup from \"../Popup.js\";\n\ntype RegisteredPopupT = {\n\tinstance: Popup;\n\tparentPopovers: Array<Popup>;\n}\n\nlet openedRegistry: Array<RegisteredPopupT> = [];\n\nconst addOpenedPopup = (instance: Popup, parentPopovers: Array<Popup> = []) => {\n\tif (!openedRegistry.some(popup => popup.instance === instance)) {\n\t\topenedRegistry.push({\n\t\t\tinstance,\n\t\t\tparentPopovers,\n\t\t});\n\t}\n\n\t_updateTopModalPopup();\n\n\tif (openedRegistry.length === 1) {\n\t\tattachGlobalListener();\n\t}\n};\n\nconst removeOpenedPopup = (instance: Popup) => {\n\topenedRegistry = openedRegistry.filter(el => {\n\t\treturn el.instance !== instance;\n\t});\n\n\t_updateTopModalPopup();\n\n\tif (!openedRegistry.length) {\n\t\tdetachGlobalListener();\n\t}\n};\n\nconst getOpenedPopups = () => {\n\treturn [...openedRegistry];\n};\n\nconst _keydownListener = (event: KeyboardEvent) => {\n\tif (!openedRegistry.length) {\n\t\treturn;\n\t}\n\n\tif (isEscape(event)) {\n\t\topenedRegistry[openedRegistry.length - 1].instance.close(true);\n\t}\n};\n\nconst attachGlobalListener = () => {\n\tdocument.addEventListener(\"keydown\", _keydownListener);\n};\n\nconst detachGlobalListener = () => {\n\tdocument.removeEventListener(\"keydown\", _keydownListener);\n};\n\nconst _updateTopModalPopup = () => {\n\tlet popup;\n\tlet hasModal = false;\n\n\tfor (let i = openedRegistry.length - 1; i >= 0; i--) {\n\t\tpopup = openedRegistry[i].instance;\n\n\t\tif (!hasModal && popup.isModal) {\n\t\t\tpopup.isTopModalPopup = true;\n\t\t\thasModal = true;\n\t\t} else {\n\t\t\tpopup.isTopModalPopup = false;\n\t\t}\n\t}\n};\n\nexport { addOpenedPopup, removeOpenedPopup, getOpenedPopups };\n"]}